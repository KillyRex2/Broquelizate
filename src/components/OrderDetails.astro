---
import { Formatter } from '../utils';

interface Order {
  id: string;
  orderNumber: string;
  customerEmail: string;
  shippingAddress: string;
  subtotal: number;
  tax: number;
  total: number;
  paymentMethod: string;
  createdAt: Date;
}

interface OrderItem {
  productName: string;
  quantity: number;
  price: number;
  subtotal: number;
}

const { order, items } = Astro.props;
const address = JSON.parse(order.shippingAddress);
---

<div class="bg-white rounded-lg shadow-md overflow-hidden">
  <div class="bg-purple-600 text-white p-6">
    <h1 class="text-2xl font-bold">¡Gracias por tu compra!</h1>
    <p class="opacity-90 mt-2">Tu orden ha sido procesada exitosamente</p>
  </div>
  
  <div class="p-6">
    <div class="flex flex-col md:flex-row justify-between gap-6">
      <div class="md:w-1/2">
        <h2 class="text-xl font-semibold mb-4">Detalles de la Orden</h2>
        
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="font-medium">Número de Orden:</span>
            <span>#{order.orderNumber}</span>
          </div>
          
          <div class="flex justify-between">
            <span class="font-medium">Fecha:</span>
            <span>{new Date(order.createdAt).toLocaleDateString('es-MX', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            })}</span>
          </div>
          
          <div class="flex justify-between">
            <span class="font-medium">Total:</span>
            <span class="font-bold">{Formatter.currency(order.total)}</span>
          </div>
          
          <div class="flex justify-between">
            <span class="font-medium">Método de Pago:</span>
            <span>{order.paymentMethod === 'cash' ? 'Efectivo' : 'Tarjeta'}</span>
          </div>
        </div>
      </div>
      
      <div class="md:w-1/2">
        <h2 class="text-xl font-semibold mb-4">Dirección de Envío</h2>
        
        <div class="space-y-2">
          <p>{address.streetAddress}</p>
          <p>{address.neighborhood}</p>
          <p>{address.city}, {address.state} {address.postalCode}</p>
          <p>{address.country}</p>
          <p class="mt-3">
            <span class="font-medium">Email:</span> {order.customerEmail}
          </p>
        </div>
      </div>
    </div>
    
    <div class="mt-8">
      <h2 class="text-xl font-semibold mb-4">Productos</h2>
      
      <div class="border rounded-lg overflow-hidden">
        <table class="w-full">
          <thead class="bg-gray-100">
            <tr>
              <th class="text-left py-3 px-4">Producto</th>
              <th class="text-center py-3 px-4">Cantidad</th>
              <th class="text-right py-3 px-4">Precio Unitario</th>
              <th class="text-right py-3 px-4">Total</th>
            </tr>
          </thead>
          <tbody>
            {items.map(item => (
              <tr class="border-b">
                <td class="py-3 px-4">{item.productName}</td>
                <td class="text-center py-3 px-4">{item.quantity}</td>
                <td class="text-right py-3 px-4">{Formatter.currency(item.price)}</td>
                <td class="text-right py-3 px-4">{Formatter.currency(item.subtotal)}</td>
              </tr>
            ))}
          </tbody>
          <tfoot class="bg-gray-50">
            <tr>
              <td colspan="3" class="text-right font-semibold py-3 px-4">Subtotal:</td>
              <td class="text-right py-3 px-4">{Formatter.currency(order.subtotal)}</td>
            </tr>
            <tr>
              <td colspan="3" class="text-right font-semibold py-3 px-4">Impuestos (15%):</td>
              <td class="text-right py-3 px-4">{Formatter.currency(order.tax)}</td>
            </tr>
            <tr class="border-t">
              <td colspan="3" class="text-right font-semibold py-3 px-4">Total:</td>
              <td class="text-right py-3 px-4 font-bold">{Formatter.currency(order.total)}</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
    
    <div class="mt-8 flex justify-center">
      <a href="/" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors">
        Volver al Inicio
      </a>
    </div>
  </div>
</div>